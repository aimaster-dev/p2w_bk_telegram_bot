/*
 Copyright (c) 2003-2020, CKSource - Frederico Knabben. All rights reserved.
 For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
*/
(function(){function h(a){function c(a){return"string"!==typeof a?-1:CKEDITOR.tools.array.indexOf(b,function(b){return b.id===a})}function d(a){var b=a.match(/\\blipuid (\w+)\}/);a=a.match(/\\bliptag(-?\d+)/);return b?b[1]:a?a[1]:null}var e=CKEDITOR.plugins.pastetools.filters.common.rtf,b=[];a=e.removeGroups(a,"(?:(?:header|footer)[lrf]?|nonshppict|shprslt)");a=e.getGroups(a,"pict");if(!a)return b;for(var k=0;k<a.length;k++){var g=a[k].content,h=d(g),l=q(g),f=c(h),m=-1!==f&&b[f].hex,n=m&&b[f].type===
l,m=m&&b[f].type!==l&&f===b.length-1,p=-1!==g.indexOf("\\defshp"),r=-1!==CKEDITOR.tools.array.indexOf(CKEDITOR.pasteFilters.image.supportedImageTypes,l);n?b.push(b[f]):m||p||(g={id:h,hex:r?e.extractGroupContent(g).replace(/\s/g,""):null,type:l},-1!==f?b.splice(f,1,g):b.push(g))}return b}function n(a){for(var c=/<img[^>]+src="([^"]+)[^>]+/g,d=[],e;e=c.exec(a);)d.push(e[1]);return d}function q(a){var c=CKEDITOR.tools.array.find(CKEDITOR.pasteFilters.image.recognizableImageTypes,function(c){return c.marker.test(a)});
return c?c.type:"unknown"}function p(a){return-1===CKEDITOR.tools.array.indexOf(CKEDITOR.pasteFilters.image.supportedImageTypes,a.type)?null:a.type?"data:"+a.type+";base64,"+CKEDITOR.tools.convertBytesToBase64(CKEDITOR.tools.convertHexStringToBytes(a.hex)):null}CKEDITOR.pasteFilters.image=function(a,c,d){var e,b;if(!d||c.activeFilter&&!c.activeFilter.check("img[src]"))return a;c=n(a);if(0===c.length)return a;d=h(d);if(0===d.length)return a;e=CKEDITOR.tools.array.map(d,function(a){return p(a)},this);
if(c.length!==e.length)return CKEDITOR.error("pastetools-failed-image-extraction",{rtf:d.length,html:c.length}),a;for(b=0;b<c.length;b++)if(0===c[b].indexOf("file://"))if(e[b]){var k=c[b].replace(/\\/g,"\\\\");a=a.replace(new RegExp("(\x3cimg [^\x3e]*src\x3d[\"']?)"+k),"$1"+e[b])}else CKEDITOR.error("pastetools-unsupported-image",{type:d[b].type,index:b});return a};CKEDITOR.pasteFilters.image.extractFromRtf=h;CKEDITOR.pasteFilters.image.extractTagsFromHtml=n;CKEDITOR.pasteFilters.image.getImageType=
q;CKEDITOR.pasteFilters.image.createSrcWithBase64=p;CKEDITOR.pasteFilters.image.supportedImageTypes=["image/png","image/jpeg"];CKEDITOR.pasteFilters.image.recognizableImageTypes=[{marker:/\\pngblip/,type:"image/png"},{marker:/\\jpegblip/,type:"image/jpeg"},{marker:/\\emfblip/,type:"image/emf"},{marker:/\\wmetafile\d/,type:"image/wmf"}]})();